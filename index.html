<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>corewatcher</title>
  <meta name="theme-color" content="#07070c" />
  <meta name="description" content="corewatcher portal — private homelab access via Tailscale + live server heartbeat." />
  <style>
    :root{
      --bg:#07070c;
      --card:rgba(255,255,255,.05);
      --border:rgba(255,255,255,.11);
      --text:#f2f2fb;
      --muted:rgba(242,242,251,.72);

      --good:#38f29b;
      --bad:#ff4d6d;
      --warn:#ffd166;

      --accent:#ff2d55;
      --accent2:#8b5cf6;
      --accent3:#22d3ee;

      --shadow: 0 18px 55px rgba(0,0,0,.45);
      --radius: 22px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background: var(--bg);
      overflow-x:hidden;
    }

    /* Animated background aura */
    .bg{
      position:fixed; inset:0;
      background:
        radial-gradient(900px 520px at 18% 10%, rgba(255,45,85,.20), transparent 60%),
        radial-gradient(900px 520px at 88% 25%, rgba(139,92,246,.16), transparent 60%),
        radial-gradient(1000px 620px at 50% 100%, rgba(34,211,238,.10), transparent 60%),
        radial-gradient(1100px 800px at 50% 50%, rgba(255,255,255,.04), transparent 55%);
      filter: saturate(1.15);
      pointer-events:none;
    }
    .noise{
      position:fixed; inset:-20%;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='140' height='140'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.85' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='140' height='140' filter='url(%23n)' opacity='.22'/%3E%3C/svg%3E");
      opacity:.12;
      mix-blend-mode: overlay;
      pointer-events:none;
      transform: rotate(2deg);
    }
    .shine{
      position:fixed; inset:0;
      background: linear-gradient(110deg,
        transparent 0%,
        rgba(255,255,255,.05) 12%,
        transparent 24%,
        transparent 100%
      );
      animation: sweep 10s linear infinite;
      pointer-events:none;
      opacity:.35;
    }
    @keyframes sweep{
      0%{ transform: translateX(-60%); }
      100%{ transform: translateX(120%); }
    }

    .wrap{
      position:relative;
      width:min(1080px, 100%);
      margin:0 auto;
      padding: 28px 18px 34px;
    }

    /* Top header */
    .top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom: 18px;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:14px;
      min-width: 260px;
    }
    .logo{
      width:46px; height:46px;
      border-radius:16px;
      background:
        radial-gradient(18px 18px at 30% 30%, rgba(255,255,255,.65), transparent 55%),
        linear-gradient(135deg, rgba(255,45,85,.95), rgba(139,92,246,.35));
      border: 1px solid rgba(255,255,255,.16);
      box-shadow: 0 18px 48px rgba(255,45,85,.16);
      position:relative;
      overflow:hidden;
    }
    .logo::after{
      content:"";
      position:absolute; inset:-60%;
      background: conic-gradient(from 140deg, transparent, rgba(255,255,255,.25), transparent 60%);
      animation: spin 7.5s linear infinite;
      opacity:.65;
    }
    @keyframes spin{
      to{ transform: rotate(360deg); }
    }
    .brand h1{
      font-size: 22px;
      margin:0;
      letter-spacing:.2px;
    }
    .subtitle{
      margin-top:2px;
      font-size: 13px;
      color: var(--muted);
    }

    /* Status pill */
    .pill{
      display:flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.04);
      border: 1px solid var(--border);
      box-shadow: 0 10px 28px rgba(0,0,0,.22);
      white-space:nowrap;
      user-select:none;
    }
    .dot{
      width:10px; height:10px;
      border-radius:50%;
      background: var(--warn);
      box-shadow: 0 0 0 0 rgba(255, 209, 102, .0);
    }
    .pillText{
      font-size: 13px;
      color: rgba(242,242,251,.85);
    }
    .pulse-good{ animation: pulseGood 1.7s ease-in-out infinite; }
    .pulse-bad{ animation: pulseBad 1.2s ease-in-out infinite; }
    @keyframes pulseGood{
      0%{ box-shadow: 0 0 0 0 rgba(56,242,155,.0); }
      40%{ box-shadow: 0 0 0 10px rgba(56,242,155,.12); }
      100%{ box-shadow: 0 0 0 18px rgba(56,242,155,.0); }
    }
    @keyframes pulseBad{
      0%{ box-shadow: 0 0 0 0 rgba(255,77,109,.0); }
      35%{ box-shadow: 0 0 0 11px rgba(255,77,109,.12); }
      100%{ box-shadow: 0 0 0 20px rgba(255,77,109,.0); }
    }

    /* Cards */
    .grid{
      display:grid;
      grid-template-columns: 1.25fr .75fr;
      gap: 14px;
    }
    @media (max-width: 900px){
      .grid{ grid-template-columns: 1fr; }
      .top{ align-items:flex-start; flex-direction:column; }
      .pill{ width: fit-content; }
    }

    .card{
      position:relative;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px;
      backdrop-filter: blur(12px);
      overflow:hidden;
    }
    .card::before{
      content:"";
      position:absolute; inset:0;
      background:
        linear-gradient(120deg,
          rgba(255,45,85,.18),
          rgba(139,92,246,.10),
          rgba(34,211,238,.08),
          transparent 70%);
      opacity:.32;
      pointer-events:none;
      transform: translateY(-35%);
    }
    .card::after{
      content:"";
      position:absolute; inset:0;
      border-radius: var(--radius);
      background: radial-gradient(520px 180px at 25% 0%, rgba(255,255,255,.08), transparent 65%);
      pointer-events:none;
      opacity:.55;
    }
    .card > *{ position:relative; z-index:1; }

    .card h2{
      margin:0 0 10px;
      font-size: 18px;
      letter-spacing:.2px;
    }
    .muted{
      color: var(--muted);
      line-height:1.55;
      font-size: 14px;
      margin:0 0 12px;
    }
    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 13px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      padding: 3px 8px;
      border-radius: 10px;
      color: rgba(242,242,251,.92);
      display:inline-block;
      transform: translateY(-1px);
    }

    .btnRow{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top: 8px;
    }
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      padding: 12px 14px;
      border-radius: 16px;
      text-decoration:none;
      font-weight: 760;
      letter-spacing:.2px;
      color: var(--text);
      border: 1px solid rgba(255,255,255,.16);
      background: linear-gradient(135deg, rgba(255,45,85,.30), rgba(139,92,246,.16));
      box-shadow: 0 14px 38px rgba(255,45,85,.12);
      transition: transform .09s ease, filter .2s ease, background .2s ease;
    }
    .btn:hover{ transform: translateY(-1px); filter: brightness(1.05); }
    .btn:active{ transform: translateY(0px); filter: brightness(.98); }
    .btn.secondary{
      background: rgba(255,255,255,.04);
      box-shadow: none;
      font-weight: 680;
      color: rgba(242,242,251,.92);
    }
    .btn.disabled{
      opacity:.55;
      pointer-events:none;
      filter: grayscale(.2);
    }

    .steps{
      margin: 10px 0 0 18px;
      color: var(--muted);
      line-height:1.6;
      font-size: 14px;
    }

    .kv{
      display:grid;
      grid-template-columns: 120px 1fr;
      gap: 10px;
      margin-top: 10px;
      align-items:start;
    }
    .k{ color: rgba(242,242,251,.65); font-size: 13px; }
    .v{ color: rgba(242,242,251,.92); font-size: 14px; }

    .small{
      margin-top: 12px;
      font-size: 12px;
      color: rgba(242,242,251,.62);
      line-height:1.4;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      font-size: 12px;
      color: rgba(242,242,251,.82);
    }
    .badgeDot{ width:8px; height:8px; border-radius:50%; background: var(--warn); }

    .footer{
      margin-top: 14px;
      display:flex;
      justify-content:space-between;
      flex-wrap:wrap;
      gap:10px;
      color: rgba(242,242,251,.50);
      font-size: 12px;
    }
    .link{
      color: rgba(242,242,251,.72);
      text-decoration: none;
      border-bottom: 1px dashed rgba(242,242,251,.25);
    }
    .link:hover{ color: rgba(242,242,251,.92); border-bottom-color: rgba(242,242,251,.45); }

    /* Bottom decoration */
    .decor{
      margin-top: 18px;
      padding: 14px 18px;
      border-radius: var(--radius);
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      box-shadow: 0 14px 40px rgba(0,0,0,.25);
      overflow:hidden;
      position:relative;
    }
    .decor::before{
      content:"";
      position:absolute; inset:-30%;
      background: conic-gradient(from 180deg,
        rgba(255,45,85,.0),
        rgba(255,45,85,.18),
        rgba(139,92,246,.14),
        rgba(34,211,238,.12),
        rgba(255,45,85,.0)
      );
      animation: spin 14s linear infinite;
      opacity:.55;
    }
    .decorInner{
      position:relative;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      z-index:1;
    }
    .sig{
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .sigTitle{
      font-weight: 800;
      letter-spacing:.3px;
      font-size: 13px;
      opacity:.92;
    }
    .sigSub{
      font-size: 12px;
      color: rgba(242,242,251,.66);
      line-height:1.35;
    }
    .sparkline{
      width: 220px;
      max-width: 42vw;
      height: 42px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.22);
      overflow:hidden;
      position:relative;
    }
    .sparkline svg{
      width:100%; height:100%;
      display:block;
      opacity:.95;
    }
    .sparkGlow{
      position:absolute; inset:0;
      background: radial-gradient(120px 60px at 20% 50%, rgba(56,242,155,.18), transparent 65%);
      opacity:.0;
      transition: opacity .25s ease;
      pointer-events:none;
    }
  </style>
</head>

<body>
  <div class="bg"></div>
  <div class="noise"></div>
  <div class="shine"></div>

  <div class="wrap">
    <div class="top">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>corewatcher</h1>
          <div class="subtitle">Private homelab portal · Tailnet access</div>
        </div>
      </div>

      <div class="pill" id="healthPill" title="Updated by the server. If updates stop, assume it's down.">
        <span class="dot" id="healthDot"></span>
        <span class="pillText" id="healthText">Checking server…</span>
      </div>
    </div>

    <div class="grid">
      <section class="card">
        <h2>Access</h2>
        <p class="muted">
          This homelab is private. You need Tailscale to reach internal services.
        </p>

        <div class="btnRow">
          <a class="btn" href="https://login.tailscale.com/" target="_blank" rel="noopener">
            Connect via Tailscale →
          </a>

          <a class="btn secondary" id="homeBtn" href="https://home.corewatcher.com" target="_blank" rel="noopener">
            Open Control Center (Homarr)
          </a>

          <a class="btn secondary" href="https://tailscale.com/download" target="_blank" rel="noopener">
            Download Tailscale
          </a>
        </div>

        <div style="height:14px"></div>

        <span class="badge">
          <span class="badgeDot" id="badgeDot"></span>
          Quick steps
        </span>

        <ol class="steps">
          <li>Install Tailscale on your device.</li>
          <li>Sign in on <span class="kbd">login.tailscale.com</span>.</li>
          <li>Turn Tailscale “On”.</li>
          <li>Open <span class="kbd">home.corewatcher.com</span> to confirm access.</li>
        </ol>

        <div class="small">
          The Control Center is reachable only when connected to the Tailnet.
        </div>
      </section>

      <section class="card">
        <h2>Server health</h2>
        <p class="muted" style="margin-bottom:10px">
          Updated by the server itself. If updates stop, assume it’s down.
        </p>

        <div class="kv">
          <div class="k">Status</div><div class="v" id="statusLine">—</div>
          <div class="k">Last seen</div><div class="v" id="lastSeen">—</div>
          <div class="k">Message</div><div class="v" id="message">—</div>
        </div>

        <div class="small" id="hint"></div>

        <div class="footer">
          <div id="ageLine">—</div>
          <div>
            <a class="link" href="./health.json" target="_blank" rel="noopener">health.json</a>
          </div>
        </div>
      </section>
    </div>

    <!-- Bottom decoration -->
    <section class="decor" aria-hidden="true">
      <div class="decorInner">
        <div class="sig">
          <div class="sigTitle">corewatcher signal</div>
          <div class="sigSub">a tiny heartbeat from the void — updated every few minutes.</div>
        </div>

        <div class="sparkline">
          <div class="sparkGlow" id="sparkGlow"></div>
          <!-- cute little waveform (static, but we change glow based on status) -->
          <svg viewBox="0 0 220 42" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M0 26 C18 26 18 10 36 10 C54 10 54 34 72 34 C90 34 90 16 108 16 C126 16 126 30 144 30 C162 30 162 8 180 8 C198 8 198 26 220 26"
              stroke="rgba(242,242,251,.70)" stroke-width="2.2" />
            <path d="M0 26 C18 26 18 10 36 10 C54 10 54 34 72 34 C90 34 90 16 108 16 C126 16 126 30 144 30 C162 30 162 8 180 8 C198 8 198 26 220 26"
              stroke="rgba(255,45,85,.55)" stroke-width="1.2" />
          </svg>
        </div>
      </div>
    </section>
  </div>

<script>
  const HEALTH_URL = "./health.json?cachebust=" + Date.now();
  const STALE_MINUTES = 6; // if last_seen older than this => offline

  const el = (id) => document.getElementById(id);

  function setStatus(state, text){
    const dot = el("healthDot");
    const badgeDot = el("badgeDot");
    const pill = el("healthPill");
    const sparkGlow = el("sparkGlow");
    const homeBtn = el("homeBtn");

    el("healthText").textContent = text;

    dot.classList.remove("pulse-good","pulse-bad");

    if(state === "up"){
      dot.style.background = "var(--good)";
      badgeDot.style.background = "var(--good)";
      pill.style.borderColor = "rgba(56,242,155,.35)";
      dot.classList.add("pulse-good");
      if (sparkGlow) sparkGlow.style.opacity = "1";
      if (homeBtn) homeBtn.classList.remove("disabled");
    } else if(state === "down"){
      dot.style.background = "var(--bad)";
      badgeDot.style.background = "var(--bad)";
      pill.style.borderColor = "rgba(255,77,109,.35)";
      dot.classList.add("pulse-bad");
      if (sparkGlow) sparkGlow.style.opacity = ".10";
      // purely UX: disable the button when server is down (still viewable in source, ofc)
      if (homeBtn) homeBtn.classList.add("disabled");
    } else {
      dot.style.background = "var(--warn)";
      badgeDot.style.background = "var(--warn)";
      pill.style.borderColor = "rgba(255,209,102,.35)";
      if (sparkGlow) sparkGlow.style.opacity = ".35";
      if (homeBtn) homeBtn.classList.remove("disabled");
    }
  }

  function fmt(ts){
    try { return new Date(ts).toLocaleString(); } catch { return ts; }
  }

  function minutesAgo(ts){
    try{
      const ms = Date.now() - new Date(ts).getTime();
      return Math.max(0, Math.floor(ms / 60000));
    } catch {
      return null;
    }
  }

  async function loadHealth(){
    try{
      const res = await fetch(HEALTH_URL, { cache: "no-store" });
      if(!res.ok) throw new Error("health.json not ok");
      const data = await res.json();

      const lastSeen = data.last_seen ? fmt(data.last_seen) : "—";
      el("lastSeen").textContent = lastSeen;
      el("message").textContent = data.message || "—";

      // stale logic
      let stale = true;
      let ageMins = null;
      if(data.last_seen){
        ageMins = minutesAgo(data.last_seen);
        stale = ageMins === null ? true : (ageMins > STALE_MINUTES);
      }

      const serverUp = (data.server === "up") && !stale;

      el("statusLine").textContent = serverUp ? "Online ✅" : "Offline ❌";

      if(serverUp){
        setStatus("up","Server online");
        el("hint").textContent = "If you still can’t reach the Control Center: connect Tailscale.";
      } else {
        setStatus("down","Server offline / unreachable");
        el("hint").textContent = "If you expected it to be up: check power, internet, Docker, or maintenance.";
      }

      if(ageMins === null){
        el("ageLine").textContent = "Last update: unknown";
      } else {
        el("ageLine").textContent = `Last update: ${ageMins} min ago`;
      }

    } catch (e){
      setStatus("down","Server offline / unreachable");
      el("statusLine").textContent = "Offline ❌";
      el("lastSeen").textContent = "—";
      el("message").textContent = "No health data available.";
      el("hint").textContent = "Health feed missing. Ensure health.json exists and is reachable.";
      el("ageLine").textContent = "Last update: —";
    }
  }

  loadHealth();
</script>
</body>
</html>
