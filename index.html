<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>corewatcher</title>
  <style>
    :root{
      --bg:#0b0b10; --card:rgba(255,255,255,.04); --border:rgba(255,255,255,.10);
      --text:#eaeaf2; --muted:rgba(234,234,242,.75);
      --good:#4ade80; --bad:#fb7185; --warn:#fbbf24;
      --accent:#ff2d55;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:radial-gradient(1200px 700px at 20% 10%, rgba(255,45,85,.18), transparent 55%),
                 radial-gradient(900px 600px at 90% 90%, rgba(255,45,85,.10), transparent 55%),
                 var(--bg);
      color:var(--text);
      min-height:100vh; display:grid; place-items:center; padding:22px;
    }
    .wrap{width:min(960px,100%)}
    .top{display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:16px}
    .brand{display:flex; align-items:center; gap:12px}
    .logo{
      width:42px;height:42px;border-radius:14px;
      background:linear-gradient(135deg, rgba(255,45,85,.9), rgba(255,45,85,.25));
      box-shadow:0 10px 30px rgba(255,45,85,.15);
      border:1px solid rgba(255,255,255,.12);
    }
    h1{font-size:22px;margin:0}
    .pill{
      font-size:12px; padding:7px 10px; border-radius:999px;
      border:1px solid var(--border); background:rgba(255,255,255,.03);
      color:var(--muted);
      display:flex; gap:8px; align-items:center;
      white-space:nowrap;
    }
    .dot{width:8px;height:8px;border-radius:50%}
    .grid{display:grid; grid-template-columns:1.25fr .75fr; gap:14px}
    @media (max-width: 860px){ .grid{grid-template-columns:1fr} }

    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:18px;
      padding:18px;
      backdrop-filter: blur(10px);
    }
    .btn{
      display:inline-flex; align-items:center; justify-content:center;
      padding:12px 14px; border-radius:14px; border:1px solid rgba(255,255,255,.16);
      background:rgba(255,45,85,.18);
      color:var(--text); text-decoration:none; font-weight:700;
      gap:10px;
      transition:transform .08s ease, background .18s ease;
    }
    .btn:hover{transform:translateY(-1px); background:rgba(255,45,85,.26)}
    .btn:active{transform:translateY(0px)}
    .muted{color:var(--muted); line-height:1.5}
    ol{margin:10px 0 0 18px; color:var(--muted); line-height:1.55}
    code{
      font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas;
      background:rgba(255,255,255,.06);
      padding:2px 6px; border-radius:8px; border:1px solid rgba(255,255,255,.10);
      color:rgba(234,234,242,.92);
    }
    .kv{display:grid; grid-template-columns: 120px 1fr; gap:10px; margin-top:8px}
    .k{color:rgba(234,234,242,.7)}
    .v{color:rgba(234,234,242,.92)}
    .small{font-size:12px; color:rgba(234,234,242,.65); margin-top:10px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>corewatcher</h1>
          <div class="muted" style="font-size:13px">Private homelab access via Tailscale</div>
        </div>
      </div>

      <div class="pill" id="healthPill">
        <span class="dot" id="healthDot" style="background: var(--warn)"></span>
        <span id="healthText">Checking server…</span>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <h2 style="margin:0 0 8px;font-size:18px">Get access</h2>
        <p class="muted" style="margin:0 0 12px">
          If you can’t reach services like <code>jelly.corewatcher.com</code>, you’re probably not connected to Tailscale.
        </p>

        <a class="btn" href="https://login.tailscale.com/" target="_blank" rel="noopener">
          Open Tailscale Login →
        </a>

        <h3 style="margin:16px 0 6px;font-size:15px">How to reach the server</h3>
        <ol>
          <li>Install Tailscale on your device.</li>
          <li>Sign in on <code>login.tailscale.com</code>.</li>
          <li>Turn Tailscale “On”.</li>
          <li>Open your services (e.g. <code>jelly.corewatcher.com</code>).</li>
        </ol>

        <div class="small">
          Tip: if you’re on mobile, make sure VPN/Tailscale is enabled for your current network.
        </div>
      </div>

      <div class="card">
        <h2 style="margin:0 0 8px;font-size:18px">Server health</h2>
        <p class="muted" style="margin:0 0 10px">
          This is updated by the server itself. If updates stop, assume it’s down.
        </p>

        <div class="kv">
          <div class="k">Status</div><div class="v" id="statusLine">—</div>
          <div class="k">Last seen</div><div class="v" id="lastSeen">—</div>
          <div class="k">Message</div><div class="v" id="message">—</div>
        </div>

        <div class="small" id="hint"></div>
      </div>
    </div>
  </div>

<script>
  const HEALTH_URL = "./health.json?cachebust=" + Date.now();
  const STALE_MINUTES = 6; // if no update within X minutes => offline

  function setPill(state, text){
    const dot = document.getElementById("healthDot");
    const pill = document.getElementById("healthPill");
    const healthText = document.getElementById("healthText");
    healthText.textContent = text;

    if(state === "up"){
      dot.style.background = "var(--good)";
      pill.style.borderColor = "rgba(74,222,128,.35)";
    } else if(state === "down"){
      dot.style.background = "var(--bad)";
      pill.style.borderColor = "rgba(251,113,133,.35)";
    } else {
      dot.style.background = "var(--warn)";
      pill.style.borderColor = "rgba(251,191,36,.35)";
    }
  }

  function fmt(ts){
    try { return new Date(ts).toLocaleString(); } catch { return ts; }
  }

  async function loadHealth(){
    try{
      const res = await fetch(HEALTH_URL, { cache: "no-store" });
      if(!res.ok) throw new Error("health.json not ok");
      const data = await res.json();

      document.getElementById("statusLine").textContent = (data.server === "up") ? "Online ✅" : "Offline ❌";
      document.getElementById("lastSeen").textContent = data.last_seen ? fmt(data.last_seen) : "—";
      document.getElementById("message").textContent = data.message || "—";

      // stale logic
      let stale = false;
      if(data.last_seen){
        const ageMs = Date.now() - new Date(data.last_seen).getTime();
        stale = ageMs > STALE_MINUTES * 60 * 1000;
      }

      if (data.server !== "up" || stale){
        setPill("down", "Server offline / unreachable");
        document.getElementById("hint").textContent =
          "If you expected it to be up: check power, internet, Docker, or maintenance.";
      } else {
        setPill("up", "Server online");
        document.getElementById("hint").textContent =
          "If you still can’t reach services: connect Tailscale.";
      }
    } catch (e){
      setPill("down", "Server offline / unreachable");
      document.getElementById("statusLine").textContent = "Offline ❌";
      document.getElementById("lastSeen").textContent = "—";
      document.getElementById("message").textContent = "No health data available.";
      document.getElementById("hint").textContent =
        "Health feed missing. If this is new, ensure health.json exists in the repo.";
    }
  }

  loadHealth();
</script>
</body>
</html>
